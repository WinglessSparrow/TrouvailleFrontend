@page "/register"

@using TrouvailleFrontend.Components.Checkout
@using Blazorise

@inject IRegister registerer

<div class="page">
    <div class="main-container-style register">

        <h1>Register</h1>

        <EditForm EditContext=@_registerContext OnValidSubmit="SubmitFormAsync">
            <ObjectGraphDataAnnotationsValidator />
            <div class="input-group">
                <h4>Personal Data</h4>
                <InputText id="first-name" @bind-Value=_registerData.RegisterModel.FirstName
                    @bind-Value-oninput=_registerData.RegisterModel.FirstName placeholder="First Name" />
                <InputText id="last-name" @bind-Value=_registerData.RegisterModel.LastName
                    @bind-Value-oninput=_registerData.RegisterModel.LastName placeholder="Surname" />
                <div class="tooltip-trigger">
                    <InputText type="phone" id="phone-number" @bind-Value=_registerData.RegisterModel.PhoneNumber
                        class="not-required" @bind-Value-oninput=_registerData.RegisterModel.PhoneNumber
                        placeholder="Phonenumber" />
                    <div class="tooltip-custom"><b>Not Required</b></div>
                </div>
                <div>
                    <ValidationMessage For="@(() => _registerData.RegisterModel.FirstName)" />
                    <ValidationMessage For="@(() => _registerData.RegisterModel.LastName)" />
                    <ValidationMessage For="@(() => _registerData.RegisterModel.PhoneNumber)" />
                </div>
            </div>

            <div class="input-group">
                <h4>Login Data</h4>
                <InputText type="email" @bind-Value=_registerData.RegisterModel.Email
                    @bind-Value-oninput=_registerData.RegisterModel.Email placeholder="Email" />
                <InputText type="password" @bind-Value=_registerData.RegisterModel.Password
                    @bind-Value-oninput=_registerData.RegisterModel.Password placeholder="Password" />
                <InputText type="password" @bind-Value=_registerData.RegisterModel.ConfirmPassword
                    @bind-Value-oninput=_registerData.RegisterModel.ConfirmPassword placeholder="Confirm Password" />
                <div>
                    <ValidationMessage For="@(() => _registerData.RegisterModel.ConfirmPassword)" />
                    <ValidationMessage For="@(() => _registerData.RegisterModel.Password)" />
                    <ValidationMessage For="@(() => _registerData.RegisterModel.Email)" />
                </div>
            </div>

            <div class="input-group">
                <Address AddressFor="Address" @bind-AddressM=_registerData.AddressModel />
                <div>
                    <ValidationMessage For="@(() => _registerData.AddressModel.CityName)" />
                    <ValidationMessage For="@(() => _registerData.AddressModel.State)" />
                    <ValidationMessage For="@(() => _registerData.AddressModel.PostalCode)" />
                    <ValidationMessage For="@(() => _registerData.AddressModel.Street)" />
                    <ValidationMessage For="@(() => _registerData.AddressModel.StreetNumber)" />
                    <ValidationMessage For="@(() => _registerData.AddressModel.Country)" />
                </div>
            </div>

            <div class="input-group">
                <button type="submit" class="button-style">
                    <span>
                        <i class="fas fa-user-plus "></i>
                    </span>
                </button>
            </div>
        </EditForm>
    </div>
</div>

<button @onclick=ShowModal>Show Modal</button>

<style>
    .modal-body {
        @*display:flex;justify-content:center;align-items:center;*@
    }

    .modal-body>i {
        font-size: 100px;
    }

    .check {
        display: flex;
        justify-content: center;
        align-items: center;

        height: 200px;

        color: var(--stars);
    }

    .footer {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .footer>button {
        color: var(--foreground-contrast);
    }
</style>

<Modal @ref="modalRef">
    <ModalContent Centered="true">
        @if (_registerSuccess)
        {
            <ModalHeader>
                <ModalTitle>Register Success</ModalTitle>
                <CloseButton />
            </ModalHeader>
            <ModalBody class="check">
                <i class="fas fa-check-circle"></i>
            </ModalBody>
            <ModalFooter class="footer">
                <Button>Proceed to the Store</Button>
                <Button>Proceed to the User Account</Button>
            </ModalFooter>
        }
        else
        {
            <ModalHeader>
                <ModalTitle>Register Failure</ModalTitle>
                <CloseButton />
            </ModalHeader>
            <ModalBody>
                <i class="fas fa-check-circle    "></i>
            </ModalBody>
        }
    </ModalContent>
</Modal>

@code{

    private Modal modalRef;

    private void ShowModal()
    {
        modalRef.Show();
    }

    private RegisterContext _registerData;
    private EditContext _registerContext;
    private bool _registerSuccess = true;
    protected override void OnInitialized()
    {
        _registerData = new();
        _registerContext = new(_registerData);
    }

    private async void SubmitFormAsync()
    {
        _registerData.PrepareRegisterModel();
        try
        {
            _registerSuccess = await registerer.RegisterAsync(_registerData.RegisterModel);
            if (_registerSuccess)
            {
                //show everything is ok
            }
            else
            {
                //get error string
                //show everything is not ok
            }
        }
        catch (HttpRequestException)
        {
            //server time-out / unavailable
        }
    }
}