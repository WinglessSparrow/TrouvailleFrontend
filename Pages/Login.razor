@page "/login"

@using TrouvailleFrontend.Shared.Models

@inject ILogin loginer
@inject NavigationManager navMan
@inject IJSRuntime js

<div class="login-content">
    <div class="form">
        <EditForm Model="@_loginModel" class="main-container-style" OnValidSubmit="LoginAsync">
            <DataAnnotationsValidator />
            <div>
                <label for="email">Email: </label><br />
                <InputText id="email" type="email" @bind-Value=_loginModel.Email
                    @bind-Value-oninput=_loginModel.Email />
            </div>
            <div>
                <label for="password">Password:</label><br />
                <InputText id="password" type="password" @bind-Value=_loginModel.Password
                    @bind-Value-oninput=_loginModel.Password />
            </div>
            <button type="submit" class="button-style">Log in
                <Icon Name="IconName.Key" />
            </button>
        </EditForm>
    </div>
</div>

@code{
    private bool _isSuccess = false;
    private LoginModel _loginModel = new LoginModel();

    private async Task LoginAsync()
    {
        Console.WriteLine("loggingin");

        _isSuccess = await loginer.loginAsync(_loginModel);

        if (_isSuccess)
        {
            navMan.NavigateTo("/");
        }
        else
        {
            await js.InvokeVoidAsync("alert", "Login Failed, check the data and try again");
        }
    }
}