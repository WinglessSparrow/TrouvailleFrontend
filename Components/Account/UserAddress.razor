@namespace TrouvailleFrontend.Components.Account

@using TrouvailleFrontend.Components.Checkout
@using TrouvailleFrontend.Shared.Models
@using System.ComponentModel.DataAnnotations

@inherits UserChanger

<style>
    form {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 20px
    }
</style>

<div class='addresses @(_isChangeDone? " " : "changing")'>
    <div class="form-wrapper">
        <h2>Addresses</h2>
        <EditForm EditContext="@_context" OnSubmit="@SubmitAsync">
            <ObjectGraphDataAnnotationsValidator />
            <Address AddressFor="Delivery Address" @bind-AddressM=_userData.DeliveryAddress IsDisabled=@_isChangeDone />
            <Address AddressFor="Invoice Address" @bind-AddressM=_userData.InvoiceAddress IsDisabled=@_isChangeDone />
            <button type="@_isChangeDone? 'submit' : 'button'" class="button-style">@_buttonText</button>
        </EditForm>
    </div>
</div>

@code {
    private Addresses _addresses = new();
    protected override void OnParametersSet()
    {
        base.OnParametersSet();
        _addresses.Delivery = _userData.DeliveryAddress;
        _addresses.Invoice = _userData.InvoiceAddress;
        StateHasChanged();
    }

    class Addresses
    {
        [ValidateComplexType]
        public AddressModel Delivery { get; set; }
        [ValidateComplexType]
        public AddressModel Invoice { get; set; }
    }
}